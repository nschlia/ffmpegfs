<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FFmpegfs Fuse Multi Media Filesystem: src/ffmpeg_profiles.cc File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FFmpegfs Fuse Multi Media Filesystem
   &#160;<span id="projectnumber">2.14</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">ffmpeg_profiles.cc File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Make audience audience specific optimisations.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="ffmpeg__transcoder_8h_source.html">ffmpeg_transcoder.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for ffmpeg_profiles.cc:</div>
<div class="dyncontent">
<div class="center"><img src="ffmpeg__profiles_8cc__incl.png" border="0" usemap="#asrc_2ffmpeg__profiles_8cc" alt=""/></div>
<map name="asrc_2ffmpeg__profiles_8cc" id="asrc_2ffmpeg__profiles_8cc">
<area shape="rect" title="Make audience audience specific optimisations." alt="" coords="1202,5,1366,32"/>
<area shape="rect" href="ffmpeg__transcoder_8h.html" title="FFmpeg transcoder." alt="" coords="1207,80,1361,107"/>
<area shape="rect" href="ffmpeg__base_8h.html" title="FFmpeg transcoder base." alt="" coords="574,155,693,181"/>
<area shape="rect" href="ffmpeg__frame_8h.html" title="FFmpeg AVFrame extension." alt="" coords="1037,155,1163,181"/>
<area shape="rect" href="ffmpeg__subtitle_8h.html" title="FFmpeg AVSubtitle extension." alt="" coords="876,155,1012,181"/>
<area shape="rect" href="id3v1tag_8h.html" title="ID3v1 tag structure" alt="" coords="1188,155,1279,181"/>
<area shape="rect" href="fileio_8h.html" title="FileIO class." alt="" coords="341,229,408,256"/>
<area shape="rect" href="ffmpeg__profiles_8h.html" title="FFmpeg encoder profiles." alt="" coords="717,155,851,181"/>
<area shape="rect" title=" " alt="" coords="1303,155,1366,181"/>
<area shape="rect" title=" " alt="" coords="1391,155,1455,181"/>
<area shape="rect" title=" " alt="" coords="1479,155,1547,181"/>
<area shape="rect" title=" " alt="" coords="1571,155,1658,181"/>
<area shape="rect" title=" " alt="" coords="1683,155,1757,181"/>
<area shape="rect" title=" " alt="" coords="1781,155,1848,181"/>
<area shape="rect" href="ffmpeg__utils_8h.html" title="Various FFmpegfs utility functions." alt="" coords="747,229,861,256"/>
<area shape="rect" href="ffmpeg__compat_8h.html" title="FFmpeg API compatibility." alt="" coords="989,304,1125,331"/>
<area shape="rect" title=" " alt="" coords="520,304,579,331"/>
<area shape="rect" title=" " alt="" coords="433,304,495,331"/>
<area shape="rect" title=" " alt="" coords="1149,304,1208,331"/>
<area shape="rect" title=" " alt="" coords="1232,304,1275,331"/>
<area shape="rect" title=" " alt="" coords="1299,304,1355,331"/>
<area shape="rect" title=" " alt="" coords="603,304,674,331"/>
<area shape="rect" title=" " alt="" coords="699,304,765,331"/>
<area shape="rect" title=" " alt="" coords="790,304,965,331"/>
<area shape="rect" title=" " alt="" coords="905,229,983,256"/>
<area shape="rect" title=" " alt="" coords="157,304,243,331"/>
<area shape="rect" title=" " alt="" coords="267,304,317,331"/>
<area shape="rect" title=" " alt="" coords="341,304,408,331"/>
<area shape="rect" title=" " alt="" coords="5,304,133,331"/>
</map>
</div>
</div>
<p><a href="ffmpeg__profiles_8cc_source.html">Go to the source code of this file.</a></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Make audience audience specific optimisations. </p>
<dl class="section see"><dt>See also</dt><dd><a href="https://www.ffmpeg.org/ffmpeg-formats.html#mov_002c-mp4_002c-ismv">https://www.ffmpeg.org/ffmpeg-formats.html#mov_002c-mp4_002c-ismv</a></dd></dl>
<h1><a class="anchor" id="autotoc_md0"></a>
MOV/MP4/ISMV (Smooth Streaming) muxer</h1>
<p>The mov/mp4/ismv muxer supports fragmentation. Normally, a MOV/MP4 file has all the metadata about all packets stored in one location (written at the end of the file, it can be moved to the start for better playback by adding faststart to the movflags, or using the qt-faststart tool). A fragmented file consists of a number of fragments, where packets and metadata about these packets are stored together. Writing a fragmented file has the advantage that the file is decodable even if the writing is interrupted (while a normal MOV/MP4 is undecodable if it is not properly finished), and it requires less memory when writing very long files (since writing normal MOV/MP4 files stores info about every single packet in memory until the file is closed). The downside is that it is less compatible with other applications.</p>
<h2><a class="anchor" id="autotoc_md1"></a>
Options</h2>
<p>Fragmentation is enabled by setting one of the AVOptions that define how to cut the file into fragments: </p><pre class="fragment">-moov_size bytes
</pre><p> Reserves space for the moov atom at the beginning of the file instead of placing the moov atom at the end. If the space reserved is insufficient, muxing will fail. </p><pre class="fragment">-movflags frag_keyframe
</pre><p> Start a new fragment at each video keyframe. </p><pre class="fragment">-frag_duration duration
</pre><p> Create fragments that are duration microseconds long. </p><pre class="fragment">-frag_size size
</pre><p> Create fragments that contain up to size bytes of payload data. </p><pre class="fragment">-movflags frag_custom
</pre><p> Allow the caller to manually choose when to cut fragments, by calling av_write_frame(ctx, nullptr) to write a fragment with the packets written so far. (This is only useful with other applications integrating libavformat, not from ffmpeg.) </p><pre class="fragment">-min_frag_duration duration
</pre><p> Donâ€™t create fragments that are shorter than duration microseconds long.</p>
<p>If more than one condition is specified, fragments are cut when one of the specified conditions is fulfilled. The exception to this is -min_frag_duration, which has to be fulfilled for any of the other conditions to apply.</p>
<p>Additionally, the way the output file is written can be adjusted through a few other options: </p><pre class="fragment">-movflags empty_moov
</pre><p> Write an initial moov atom directly at the start of the file, without describing any samples in it. Generally, an mdat/moov pair is written at the start of the file, as a normal MOV/MP4 file, containing only a short portion of the file. With this option set, there is no initial mdat atom, and the moov atom only describes the tracks but has a zero duration.</p>
<p>This option is implicitly set when writing ismv (Smooth Streaming) files. </p><pre class="fragment">-movflags separate_moof
</pre><p> Write a separate moof (movie fragment) atom for each track. Normally, packets for all tracks are written in a moof atom (which is slightly more efficient), but with this option set, the muxer writes one moof/mdat pair for each track, making it easier to separate tracks.</p>
<p>This option is implicitly set when writing ismv (Smooth Streaming) files. </p><pre class="fragment">-movflags faststart
</pre><p> Run a second pass moving the index (moov atom) to the beginning of the file. This operation can take a while, and will not work in various situations such as fragmented output, thus it is not enabled by default. </p><pre class="fragment">-movflags rtphint
</pre><p> Add RTP hinting tracks to the output file. </p><pre class="fragment">-movflags disable_chpl
</pre><p> Disable Nero chapter markers (chpl atom). Normally, both Nero chapters and a QuickTime chapter track are written to the file. With this option set, only the QuickTime chapter track will be written. Nero chapters can cause failures when the file is reprocessed with certain tagging programs, like mp3Tag 2.61a and iTunes 11.3, most likely other versions are affected as well. </p><pre class="fragment">-movflags omit_tfhd_offset
</pre><p> Do not write any absolute base_data_offset in tfhd atoms. This avoids tying fragments to absolute byte positions in the file/streams. </p><pre class="fragment">-movflags default_base_moof
</pre><p> Similarly to the omit_tfhd_offset, this flag avoids writing the absolute base_data_offset field in tfhd atoms, but does so by using the new default-base-is-moof flag instead. This flag is new from 14496-12:2012. This may make the fragments easier to parse in certain circumstances (avoiding basing track fragment location calculations on the implicit end of the previous track fragment). </p><pre class="fragment">-write_tmcd
</pre><p> Specify on to force writing a timecode track, off to disable it and auto to write a timecode track only for mov and mp4 output (default). </p><pre class="fragment">-movflags negative_cts_offsets
</pre><p> Enables utilization of version 1 of the CTTS box, in which the CTS offsets can be negative. This enables the initial sample to have DTS/CTS of zero, and reduces the need for edit lists for some cases such as video tracks with B-frames. Additionally, eases conformance with the DASH-IF interoperability guidelines.</p>
<p>Possible codec options:</p>
<div class="fragment"><div class="line"><span class="comment">// -profile:v baseline -level 3.0</span></div>
<div class="line">{ <span class="stringliteral">&quot;profile&quot;</span>,                <span class="stringliteral">&quot;baseline&quot;</span>,                 0,  0 },</div>
<div class="line">{ <span class="stringliteral">&quot;level&quot;</span>,                  <span class="stringliteral">&quot;3.0&quot;</span>,                      0,  0 },</div>
<div class="line"> </div>
<div class="line"><span class="comment">// -profile:v high -level 3.1 - REQUIRED FOR PLAYBACK UNDER WIN7</span></div>
<div class="line">{ <span class="stringliteral">&quot;profile&quot;</span>,                <span class="stringliteral">&quot;high&quot;</span>,                     0,  0 },</div>
<div class="line">{ <span class="stringliteral">&quot;level&quot;</span>,                  <span class="stringliteral">&quot;3.1&quot;</span>,                      0,  0 },</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Set speed (changes profile!): utra/veryfast and zerolatency</span></div>
<div class="line">{ <span class="stringliteral">&quot;preset&quot;</span>,                 <span class="stringliteral">&quot;ultrafast&quot;</span>,                0,  <a class="code" href="ffmpeg__profiles_8h.html#aceff6ae60877309f3b3cd22e6df61968">OPT_SW_ONLY</a> },</div>
<div class="line">{ <span class="stringliteral">&quot;preset&quot;</span>,                 <span class="stringliteral">&quot;veryfast&quot;</span>,                 0,  <a class="code" href="ffmpeg__profiles_8h.html#aceff6ae60877309f3b3cd22e6df61968">OPT_SW_ONLY</a> },</div>
<div class="line">{ <span class="stringliteral">&quot;tune&quot;</span>,                   <span class="stringliteral">&quot;zerolatency&quot;</span>,              0,  <a class="code" href="ffmpeg__profiles_8h.html#aceff6ae60877309f3b3cd22e6df61968">OPT_SW_ONLY</a> },</div>
<div class="ttc" id="affmpeg__profiles_8h_html_aceff6ae60877309f3b3cd22e6df61968"><div class="ttname"><a href="ffmpeg__profiles_8h.html#aceff6ae60877309f3b3cd22e6df61968">OPT_SW_ONLY</a></div><div class="ttdeci">#define OPT_SW_ONLY</div><div class="ttdoc">Use this option for software encoding only.</div><div class="ttdef"><b>Definition:</b> <a href="ffmpeg__profiles_8h_source.html#l00048">ffmpeg_profiles.h:48</a></div></div>
</div><!-- fragment --><p>Possible format options:</p>
<div class="fragment"><div class="line">{ <span class="stringliteral">&quot;moov_size&quot;</span>,              <span class="stringliteral">&quot;1000000&quot;</span>,                  0, <a class="code" href="ffmpeg__profiles_8h.html#a2981c5f50d55930a31b22cc2d44a7989">OPT_ALL</a> },   <span class="comment">// bytes</span></div>
<div class="line">{ <span class="stringliteral">&quot;movflags&quot;</span>,               <span class="stringliteral">&quot;+frag_keyframe&quot;</span>,           0, <a class="code" href="ffmpeg__profiles_8h.html#a2981c5f50d55930a31b22cc2d44a7989">OPT_ALL</a> },</div>
<div class="line">{ <span class="stringliteral">&quot;frag_duration&quot;</span>,          <span class="stringliteral">&quot;1000000&quot;</span>,                  0, <a class="code" href="ffmpeg__profiles_8h.html#a2981c5f50d55930a31b22cc2d44a7989">OPT_ALL</a> },   <span class="comment">// microseconds</span></div>
<div class="line">{ <span class="stringliteral">&quot;frag_size&quot;</span>,              <span class="stringliteral">&quot;100000&quot;</span>,                   0, <a class="code" href="ffmpeg__profiles_8h.html#a2981c5f50d55930a31b22cc2d44a7989">OPT_ALL</a> },   <span class="comment">// bytes</span></div>
<div class="line">{ <span class="stringliteral">&quot;min_frag_duration&quot;</span>,      <span class="stringliteral">&quot;1000&quot;</span>,                     0, <a class="code" href="ffmpeg__profiles_8h.html#a2981c5f50d55930a31b22cc2d44a7989">OPT_ALL</a> },   <span class="comment">// microseconds</span></div>
<div class="line">{ <span class="stringliteral">&quot;movflags&quot;</span>,               <span class="stringliteral">&quot;+empty_moov&quot;</span>,              0, <a class="code" href="ffmpeg__profiles_8h.html#a2981c5f50d55930a31b22cc2d44a7989">OPT_ALL</a> },</div>
<div class="line">{ <span class="stringliteral">&quot;movflags&quot;</span>,               <span class="stringliteral">&quot;+delay_moov&quot;</span>,              0, <a class="code" href="ffmpeg__profiles_8h.html#a2981c5f50d55930a31b22cc2d44a7989">OPT_ALL</a> },</div>
<div class="line">{ <span class="stringliteral">&quot;movflags&quot;</span>,               <span class="stringliteral">&quot;+separate_moof&quot;</span>,           0, <a class="code" href="ffmpeg__profiles_8h.html#a2981c5f50d55930a31b22cc2d44a7989">OPT_ALL</a> },</div>
<div class="line">{ <span class="stringliteral">&quot;movflags&quot;</span>,               <span class="stringliteral">&quot;+faststart&quot;</span>,               0, <a class="code" href="ffmpeg__profiles_8h.html#a2981c5f50d55930a31b22cc2d44a7989">OPT_ALL</a> },</div>
<div class="line">{ <span class="stringliteral">&quot;movflags&quot;</span>,               <span class="stringliteral">&quot;+rtphint&quot;</span>,                 0, <a class="code" href="ffmpeg__profiles_8h.html#a2981c5f50d55930a31b22cc2d44a7989">OPT_ALL</a> },</div>
<div class="line">{ <span class="stringliteral">&quot;movflags&quot;</span>,               <span class="stringliteral">&quot;+disable_chpl&quot;</span>,            0, <a class="code" href="ffmpeg__profiles_8h.html#a2981c5f50d55930a31b22cc2d44a7989">OPT_ALL</a> },</div>
<div class="line">{ <span class="stringliteral">&quot;movflags&quot;</span>,               <span class="stringliteral">&quot;+omit_tfhd_offset&quot;</span>,        0, <a class="code" href="ffmpeg__profiles_8h.html#a2981c5f50d55930a31b22cc2d44a7989">OPT_ALL</a> },</div>
<div class="line">{ <span class="stringliteral">&quot;movflags&quot;</span>,               <span class="stringliteral">&quot;+default_base_moof&quot;</span>,       0, <a class="code" href="ffmpeg__profiles_8h.html#a2981c5f50d55930a31b22cc2d44a7989">OPT_ALL</a> },</div>
<div class="line">{ <span class="stringliteral">&quot;write_tmcd&quot;</span>,             <span class="stringliteral">&quot;on&quot;</span>,                       0, <a class="code" href="ffmpeg__profiles_8h.html#a2981c5f50d55930a31b22cc2d44a7989">OPT_ALL</a> },   <span class="comment">// on, off or auto</span></div>
<div class="line">{ <span class="stringliteral">&quot;movflags&quot;</span>,               <span class="stringliteral">&quot;+negative_cts_offsets&quot;</span>,    0, <a class="code" href="ffmpeg__profiles_8h.html#a2981c5f50d55930a31b22cc2d44a7989">OPT_ALL</a> },</div>
<div class="line">{ <span class="stringliteral">&quot;movflags&quot;</span>,               <span class="stringliteral">&quot;+isml&quot;</span>,                    0, <a class="code" href="ffmpeg__profiles_8h.html#a2981c5f50d55930a31b22cc2d44a7989">OPT_ALL</a> },</div>
<div class="ttc" id="affmpeg__profiles_8h_html_a2981c5f50d55930a31b22cc2d44a7989"><div class="ttname"><a href="ffmpeg__profiles_8h.html#a2981c5f50d55930a31b22cc2d44a7989">OPT_ALL</a></div><div class="ttdeci">#define OPT_ALL</div><div class="ttdoc">All files.</div><div class="ttdef"><b>Definition:</b> <a href="ffmpeg__profiles_8h_source.html#l00045">ffmpeg_profiles.h:45</a></div></div>
</div><!-- fragment --><dl class="section author"><dt>Author</dt><dd>Norbert Schlia (<a href="#" onclick="location.href='mai'+'lto:'+'nsc'+'hl'+'ia@'+'ob'+'liv'+'io'+'n-s'+'of'+'twa'+'re'+'.de'; return false;">nschl<span style="display: none;">.nosp@m.</span>ia@o<span style="display: none;">.nosp@m.</span>blivi<span style="display: none;">.nosp@m.</span>on-s<span style="display: none;">.nosp@m.</span>oftwa<span style="display: none;">.nosp@m.</span>re.d<span style="display: none;">.nosp@m.</span>e</a>) </dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>Copyright (C) 2017-2023 Norbert Schlia (<a href="#" onclick="location.href='mai'+'lto:'+'nsc'+'hl'+'ia@'+'ob'+'liv'+'io'+'n-s'+'of'+'twa'+'re'+'.de'; return false;">nschl<span style="display: none;">.nosp@m.</span>ia@o<span style="display: none;">.nosp@m.</span>blivi<span style="display: none;">.nosp@m.</span>on-s<span style="display: none;">.nosp@m.</span>oftwa<span style="display: none;">.nosp@m.</span>re.d<span style="display: none;">.nosp@m.</span>e</a>) </dd></dl>

<p class="definition">Definition in file <a class="el" href="ffmpeg__profiles_8cc_source.html">ffmpeg_profiles.cc</a>.</p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
