<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FFmpegfs Fuse Multi Media Filesystem: Installation Instructions for FFmpegfs</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">FFmpegfs Fuse Multi Media Filesystem<span id="projectnumber">&#160;2.14</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Installation Instructions for FFmpegfs </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md28"></a>
Installation from the repository</h1>
<h2><a class="anchor" id="autotoc_md29"></a>
Debian Bullseye</h2>
<p >FFmpegfs has been added to Debian 11 Bullseye so it is available as a binary distribution.</p>
<p ><b>On Debian 11 Bullseye, you get V2.2 by simply doing</b> </p><pre class="fragment">apt-get install ffmpegfs
</pre><p> Newer FFmpegfs versions can be installed on Debian 11 Bullseye from Bullseye Backports and sid (which is not recommended and therefore not described here).</p>
<p >To enable Bullseye Backports: </p><pre class="fragment"> echo "deb http://deb.debian.org/debian bullseye-backports main" | sudo tee /etc/apt/sources.list.d/backports.list

 sudo apt-get update
</pre><p> To install FFmpegfs from backports, run <code>apt-get install ffmpegfs/bullseye-backports</code> or <code>apt-get install -t bullseye-backports ffmpegfs</code>.</p>
<p ><b>For Ubuntu 20.04 or newer and Linux distributions based on it this is</b> </p><pre class="fragment">apt-get install ffmpegfs
</pre> <h2><a class="anchor" id="autotoc_md30"></a>
Debian Buster</h2>
<p >FFmpegfs can be installed on Debian 10 Buster from Buster Backports and sid (which is not recommended and therefore not described here).</p>
<p >To enable Buster Backports: </p><pre class="fragment"> echo "deb http://deb.debian.org/debian buster-backports main" | sudo tee /etc/apt/sources.list.d/backports.list

 sudo apt-get update
</pre><p> Then install FFmpegfs: </p><pre class="fragment"> sudo apt-get -t buster-backports install ffmpegfs
</pre> <h2><a class="anchor" id="autotoc_md31"></a>
Other Distributions</h2>
<p >For Arch Linux and Manjaro, it can be found in the Arch User Repository (AUR). It is available as either the latest stable version or the latest code from GIT.</p>
<h1><a class="anchor" id="autotoc_md32"></a>
Building FFmpegfs yourself</h1>
<h2><a class="anchor" id="autotoc_md33"></a>
Prerequisites</h2>
<p >For encoding and decoding, FFmpegfs utilises the FFmpeg multi media framework. The following libraries are necessary:</p>
<ul>
<li>gcc and g++ compilers</li>
<li>fuse (&gt;= 2.6.0)</li>
<li>sqlite3 (&gt;= 3.7.13)</li>
</ul>
<p >FFmpeg 4.1.8 "al-Khwarizmi" or newer:</p>
<ul>
<li>libavutil (&gt;= 56.22.100)</li>
<li>libavcodec (&gt;= 58.35.100)</li>
<li>libavformat (&gt;= 58.20.100)</li>
<li>libavfilter (&gt;= 7.40.101)</li>
<li>libswscale (&gt;= 5.3.100)</li>
<li>libswresample (&gt;= 3.3.100)</li>
</ul>
<p >For optional DVD support, you need the following libraries:</p>
<ul>
<li>libdvdread (&gt;= 5.0.0)</li>
<li>libdvdnav (&gt;= 5.0.0)</li>
</ul>
<p >For optional Blu-ray support, you need the following libraries:</p>
<ul>
<li>libbluray (&gt;= 0.6.2)</li>
</ul>
<p >The commands to only install the first set of prerequisites come next.</p>
<p >For more information, see the "Supported Linux Distributions" chapter in README.md.</p>
<p ><b>On Debian:</b> </p><pre class="fragment">apt-get install gcc g++ make pkg-config asciidoc-base w3m xxd

apt-get install fuse libfuse-dev libsqlite3-dev libavcodec-dev libavformat-dev libswresample-dev libavutil-dev libswscale-dev libavfilter-dev libcue-dev libchardet-dev
</pre><p> To get DVD support: </p><pre class="fragment">apt-get install libdvdread-dev libdvdnav-dev
</pre><p> To get Blu-ray support: </p><pre class="fragment">apt-get install libbluray-dev
</pre><p> To use "make doxy" (build Doxygen documentation): </p><pre class="fragment">apt-get install doxygen graphviz curl
</pre><p> To use "make check" (run test suite): </p><pre class="fragment">apt-get install libchromaprint-dev bc
</pre><p> <b>On Suse</b> (please read notes before continuing): </p><pre class="fragment">zypper install gcc gcc-c++

zypper install fuse fuse-devel libsqlite3-devel libavcodec-devel libavformat-devel libswresample-devel libavutil-devel libswscale-devel libcue-devel libchardet-devel
</pre><p> To get DVD support: </p><pre class="fragment">zypper install libdvdread-devel libdvdnav-devel
</pre><p> To get Blu-ray support: </p><pre class="fragment">zypper install libbluray-devel
</pre><p> Suse includes non-proprietary codecs with FFmpeg only, namely mp3, AAC and H264 are <em>not</em> available which renders this library next to usesless. But FFmpeg can be built from source, see <a href="https://trac.ffmpeg.org/wiki/CompilationGuide">https://trac.ffmpeg.org/wiki/CompilationGuide</a> and check "FFmpeg compile notes" below.</p>
<p ><b>On Red Hat:</b> </p><pre class="fragment">yum install gcc g++

yum install fuse-devel sqlite-devel libcue-devel libchardet-devel
</pre><p> To get DVD support: </p><pre class="fragment">yum install libdvdread-devel libdvdnav-devel
</pre><p> To get Blu-ray support: </p><pre class="fragment">yum install libbluray-devel
</pre><p> FFmpeg is not provided by Red Hat from its repositories. It must be built from source code. See this guide: <a href="https://trac.ffmpeg.org/wiki/CompilationGuide/Centos">https://trac.ffmpeg.org/wiki/CompilationGuide/Centos</a></p>
<p >If you want to build the documentation, you will find "asciidoc" missing from the Red Hat repositories. To get it, use a beta repository: </p><pre class="fragment">yum --enablerepo=rhel-7-server-optional-beta-rpms install asciidoc
</pre><p> <b>On Funtoo Linux:</b></p>
<p >To get fuse support and chromaprint (for make check): </p><pre class="fragment">emerge sys-fs/fuse
emerge media-libs/chromaprint
</pre><p> To get FFmpeg with H264 etc. support, specify some "USE flags" when doing emerge:</p>
<p >Create a file /etc/portage/package.use, for example "vi vi /etc/portage/package.use" and add this line: </p><pre class="fragment">media-video/ffmpeg mp3 x264 opus vorbis vpx
</pre><p> This will enable H264, mp3, Opus and WebM support. Next... </p><pre class="fragment">emerge media-libs/openh264
emerge media-sound/twolame
emerge media-video/ffmpeg
</pre><p> to build FFmpeg.</p>
<h2><a class="anchor" id="autotoc_md34"></a>
Building FFmpegfs from source code</h2>
<h3><a class="anchor" id="autotoc_md35"></a>
Building from tar ball</h3>
<p >Get the most recent release archive here: </p><pre class="fragment">wget https://github.com/nschlia/ffmpegfs/releases/download/v2.12/ffmpegfs-2.12.tar.gz
</pre><p> As I frequently fail to update this URL, you can check <a href="https://github.com/nschlia/ffmpegfs/releases">https://github.com/nschlia/ffmpegfs/releases</a> to see if there are newer releases available.</p>
<p >Alternatively, utilise these instructions, being sure to download the most recent version:</p>
<div class="fragment"><div class="line">curl -s https://api.github.com/repos/nschlia/ffmpegfs/releases/latest | \</div>
<div class="line">grep &quot;browser_download_url.*gz&quot; | \</div>
<div class="line">cut -d : -f 2,3 | \</div>
<div class="line">tr -d \&quot; | \</div>
<div class="line">wget -i -</div>
</div><!-- fragment --><p >Unpack the file, and then cd to the source directory. To build and install, run: </p><pre class="fragment">./configure
make
make install
</pre><p> Build and execute the test suite by doing: </p><pre class="fragment">make check
</pre><p> This will test audio conversion, tagging and size prediction.</p>
<h3><a class="anchor" id="autotoc_md36"></a>
Building from GIT</h3>
<p >Clone the most recent version from Github to build from GIT and stay up to date:</p>
<div class="fragment"><div class="line">git clone https://github.com/nschlia/ffmpegfs.git</div>
</div><!-- fragment --><p >Or from the mirror server:</p>
<div class="fragment"><div class="line">git clone https://salsa.debian.org/nschlia/ffmpegfs.git</div>
</div><!-- fragment --><p ><b>If building from git, you'll need these additional prerequisites:</b></p>
<ul>
<li>autoconf</li>
<li>automake</li>
<li>asciidoc (or at least asciidoc-base to save disk space)</li>
<li>w3m</li>
<li>docbook-xml</li>
</ul>
<p >For those who are lazy like me, simply copy and issue this command to get all the prerequisites: </p><pre class="fragment">apt-get install gcc g++ make pkg-config autoconf automake asciidoc-base docbook-xml xsltproc w3m libchromaprint-dev bc doxygen graphviz
</pre><p> FFmpegfs uses the GNU build system, so you'll need to run first: </p><pre class="fragment">./autogen.sh
</pre><p> If you are downloading a release, this has already been done for you. To build and install, run: </p><pre class="fragment">./configure
make
make install
</pre><p> To build and run the test suite, do: </p><pre class="fragment">make check
</pre> <h2><a class="anchor" id="autotoc_md37"></a>
Switching between repository version and source builds</h2>
<p >It is easy to switch between both worlds. You can do that as many times as you want to, but alas, the cache directory will be cleared every time. But it will be rebuilt in the background, so this will almost go unnoticed.</p>
<p >To switch from repository to a source build do</p>
<div class="fragment"><div class="line">apt-get remove ffmpegfs</div>
</div><!-- fragment --><p >Then follow the steps under "Building FFmpegfs yourself". If you do not remove the repository version, your self-build could inadvertently be up- or downgraded when a new version becomes available from the repository.</p>
<p >To switch from a source build to a repository installation, change to the build directory and do</p>
<div class="fragment"><div class="line">make uninstall</div>
</div><!-- fragment --><p >Then follow the steps under "Installation from repository".</p>
<h2><a class="anchor" id="autotoc_md38"></a>
Building Documentation</h2>
<p >The help can be created in doc or html format by running </p><pre class="fragment">make help-pdf
make help-html
</pre><p> respectively.</p>
<h1><a class="anchor" id="autotoc_md39"></a>
Building FFmpeg</h1>
<h2><a class="anchor" id="autotoc_md40"></a>
Building FFmpeg with optimisations</h2>
<p >The precompiled package of FFmpeg available for Debian, Ubuntu, etc. is built with common options so that it can run on many processors. To leverage its full potential, it may be useful to build it with optimisation options for the target CPU. The resulting binaries may not run on other computers.</p>
<p >FFmpeg must be built with at least libx264, libfdk_aac, and libmp3lame support. Other libraries, for example, ogg, Windows Media, or FLAC, must be added when these formats should be used as sources.</p>
<p ><b>Attention!</b> Remember to do "apt remove ffmpeg" before proceeding with the next steps to avoid maleficent blends of custom and official distribution binaries.</p>
<p >For a minimum build that contains all the libraries required by FFmpegfs and SSL support for convenience use: </p><pre class="fragment">configure \
    --extra-cflags='-march=native' \
    --extra-cflags=-Ofast \
    --enable-runtime-cpudetect \
    --disable-static \
    --enable-gpl \
    --enable-shared \
    --enable-version3 \
    --enable-nonfree \
    --enable-pthreads \
    --enable-postproc \
    --enable-openssl \
    --enable-libvpx \
    --enable-libvorbis \
    --enable-swresample \
    --enable-libmp3lame \
    --enable-libtheora \
    --enable-libxvid \
    --enable-libx264
</pre><p> Fix the complaints by configure, i.e., installing the required development packages, then </p><pre class="fragment">make install
</pre><p> This works for me. Decoding runs much faster with these settings.</p>
<p ><b>NOTE:</b> Depending on the source formats you have, it may be required to add additional libraries.</p>
<h1><a class="anchor" id="autotoc_md41"></a>
Trouble Shooting</h1>
<h2><a class="anchor" id="autotoc_md42"></a>
Mounting via /etc/fstab fails</h2>
<p >An fstab line with fuse.ffmpegfs file system fails with a strange message when attempted to mount with "mount -av". No log entries, no other hints...</p>
<div class="fragment"><div class="line">   mount: wrong fs type, bad option, bad superblock on /mnt/sdf1/mp3base1,</div>
<div class="line">          missing codepage or helper program, or other error</div>
<div class="line"> </div>
<div class="line">​      In some cases useful info is found in syslog - try</div>
<div class="line">​      dmesg | tail or so.</div>
</div><!-- fragment --><p >Fuse is missing! Do... </p><pre class="fragment">apt-get install fuse
</pre> <h2><a class="anchor" id="autotoc_md43"></a>
fuse: failed to exec fusermount: No such file or directory</h2>
<p >Trying to mount as any other than root, the message </p><pre class="fragment">fuse: failed to exec fusermount: No such file or directory
</pre><p> is printed.</p>
<p >Fuse is missing! Do... </p><pre class="fragment">apt-get install fuse
</pre> <h2><a class="anchor" id="autotoc_md44"></a>
"ERROR: libmp3lame &gt;= 3.98.3 not found"</h2>
<p >If you run into this "ERROR: libmp3lame &gt;= 3.98.3 not found" although you have built and installed libmp3lame you may find a solution here: <a href="https://stackoverflow.com/questions/35937403/error-libmp3lame-3-98-3-not-found">https://stackoverflow.com/questions/35937403/error-libmp3lame-3-98-3-not-found</a></p>
<h2><a class="anchor" id="autotoc_md45"></a>
autogen.sh displays "possibly undefined macro"</h2>
<pre class="fragment">Running autoreconf --install
configure.ac:46: error: possibly undefined macro: AC_DEFINE
  If this token and others are legitimate, please use m4_pattern_allow.
  See the Autoconf documentation.
autoreconf: /usr/bin/autoconf failed with exit status: 1
</pre><p> You are probably missing out on pkg-config; either it is not installed or not in path. "apt-get install pkg-config" (on Debian or equivalent on other Linux distributions) should help.</p>
<h2><a class="anchor" id="autotoc_md46"></a>
If the videotag.php script does not work under PHP7</h2>
<p >The script runs fine under PHP5, but when upgrading to PHP7 (or using PHP7) it suddenly stops showing the list of files.</p>
<p >Check the Apache2 error.log, you might see this:</p>
<p >"PHP Fatal error:  Uncaught Error: Call to undefined function utf8_encode() in index.php"</p>
<p >This is because, for some reason, utf8_encode() has been moved to the XML library. Just do (or similar): </p><pre class="fragment">apt-get install php7.0-xml
systemctl restart apache2
</pre><p> And your troubles should be gone.</p>
<h2><a class="anchor" id="autotoc_md47"></a>
"make check": all audio checks fail</h2>
<p >Log files contain "bc: command not found", so the command line communicator is missing.</p>
<p >Fix it by installing (or similar): </p><pre class="fragment"> apt-get install bc
</pre> <h2><a class="anchor" id="autotoc_md48"></a>
Make reports "/bin/sh: a2x: command not found"</h2>
<p >You are missing out on asciidoc. To install it, do (or similar): </p><pre class="fragment"> apt-get install asciidoc-base
</pre><p> That should fix it.</p>
<h2><a class="anchor" id="autotoc_md49"></a>
"make help-pdf" reports "non-zero exit status 127"</h2>
<p >Running "make help-pdf" fails like this: </p><pre class="fragment">$ make -s help-pdf
  GEN      ffmpegfs.1.pdf
a2x: ERROR: "fop"   -fo "ffmpegfs.1.fo" -pdf "ffmpegfs.1.pdf" returned non-zero exit status 127

make: *** [Makefile:918: ffmpegfs.1.pdf] Error 1
</pre><p> This happens when "fop" is missing, a command line wrapper for the Java version of fop. </p><pre class="fragment"> apt-get install fop
</pre><p> That should do it.</p>
<h2><a class="anchor" id="autotoc_md50"></a>
Make reports xmllint" --nonet --noout --valid "/home/jenkins/dev/ffmpegfs/ffmpegfs.1.xml" returned non-zero exit</h2>
<p >To find out more, run "make V=1". If you see something like (sic) "validity error : Validation failed: no DTD found !", this means that xmlint cannot access a DTD file because it is run with the &ndash;nonet option.</p>
<p >This can be solved by </p><pre class="fragment"> apt-get install docbook-xml
</pre><p> which will make the required files available offline.</p>
<h2><a class="anchor" id="autotoc_md51"></a>
libbluray fails to load libbluray.jar</h2>
<p >When you see this message while accessing blurays: </p><pre class="fragment">bdj.c:340: libbluray-j2se-0.9.3.jar not found.
bdj.c:466: BD-J check: Failed to load libbluray.jar
</pre><p> To get rid of this message, simply install "libbluray-bdj". This will make it go away. Though not necessary, as to read the Blu-ray tracks, Java support is not required, so this is simply cosmetical.</p>
<h1><a class="anchor" id="autotoc_md52"></a>
Copyright</h1>
<p >This fork with FFmpeg support copyright (C) 2017-2023 Norbert Schlia (<a href="#" onclick="location.href='mai'+'lto:'+'nsc'+'hl'+'ia@'+'ob'+'liv'+'io'+'n-s'+'of'+'twa'+'re'+'.de'; return false;">nschl<span class="obfuscator">.nosp@m.</span>ia@o<span class="obfuscator">.nosp@m.</span>blivi<span class="obfuscator">.nosp@m.</span>on-s<span class="obfuscator">.nosp@m.</span>oftwa<span class="obfuscator">.nosp@m.</span>re.d<span class="obfuscator">.nosp@m.</span>e</a>).</p>
<p >Based on work Copyright (C) 2006-2008 David Collett, 2008-2013 K. Henriksson.</p>
<p >This is free software: you are free to change and redistribute it under the terms of the GNU General Public License (GPL) version 3 or later. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4
</small></address>
</body>
</html>
